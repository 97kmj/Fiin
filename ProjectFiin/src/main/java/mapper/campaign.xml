<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<!--// Mapper: dto와 sql문 이어주는 역할 -->
<!--	# // campaign ( ) 부분은 db와 매핑 되는 값-->
<!--	# // value (#{}...) 부분은 dto와 매핑되는 값-->

<mapper namespace="mapper.campaign">

<!-- 상민 - campaignRegister(캠페인 등록)-->
	<insert id="registerCampaign" parameterType="campaign" >
		<![CDATA[
	   		INSERT INTO campaign (company_name, company_url, campaign_title, product_name, requirement,
	                     CHANNEL, image, category_id)
	    	VALUES (#{companyName}, #{companyUrl}, #{campaignTitle}, #{productName}, #{requirement},
	           			#{channel}, #{image}, #{categoryId})
	    ]]>
	</insert>

	<!--준영-->
	<select id="selectCampaign" parameterType="Integer" resultType="campaign">											
		<![CDATA[
		 	select * from campaign where campaign_num = #{campaignNum}
		 	
		]]>
	</select>
	
	<select id="selectAllCampaign" parameterType="Map" resultType="campaign">
		select * from campaign 
			<where>
				<if test="channel != null and channel.size()>0">
					<foreach collection="channel" item="item" separator="or" open="(" close=")">
					 	channel like CONCAT('%', #{item},'%')
					 </foreach>
				</if>
				<if test="categoryId != 0">
					 and category_id=#{categoryId}
				</if>
			</where> 
		order by update_start_date desc limit #{row}, 8
	</select>
	
	<select id="selectCampaignCount" parameterType="Map" resultType="integer">
		select Count(*) from Campaign
		<where>
			<if test="channel != null and channel.size()>0">
				<foreach collection="channel" item="item" separator="or" open="(" close=")">
					channel like CONCAT('%', #{item},'%')
				</foreach>
			</if>
			<if test="categoryId != 0">
				and category_id=#{categoryId}
			</if>
		</where>
	</select>
	
	<update id="CampaignIsRecruit" parameterType="map">
		<![CDATA[
			update campaign set is_recruit = #{status} where campaign_num =#{campaignNum}
		]]>
	</update>
	
	<select id="selectCampaignReceive" parameterType="Integer" resultType="Map">
		<![CDATA[
			SELECT cam.*,rec.accept FROM campaign cam LEFT JOIN receive_campaign rec ON cam.campaign_num = rec.campaign_num
			WHERE rec.influencer_num = #{influencerNum}
		]]>
	</select>

	
	<!--세나-->
	<select id="selectCampaignListForMain" resultType="campaign">
		<![CDATA[
			select * from campaign order by update_start_date desc limit 0, 8
		]]>
	</select>

	
	
	<!--민준-->
	<select id="selectCampaignByAdNum" parameterType="integer" resultType="campaign">
		select * from campaign where advertiser_num = #{advertiserNum} order by update_start_date desc 
	</select>
	
		<!-- 세원 -->
	<select id="selectCampaignForRequest" parameterType="integer" resultType="Map">
		select company_name, campaign_title, product_name, ad_end_date, campaign_num  from campaign where advertiser_num = #{advertiser_num}
		order by update_start_date desc 		
	</select>
	
	<select id="selectCampaignForBookmark" parameterType="Integer" resultType="Map">
		select c.*,g.category_name from campaign c 
		join bookmark_campaign b using(campaign_num)
		join category g using(category_id)
		where influencer_num = #{influencerNum}
	</select>
	
</mapper>	



