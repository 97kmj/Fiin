<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<!--// Mapper: dto와 sql문 이어주는 역할 -->
<!--	# // campaign ( ) 부분은 db와 매핑 되는 값-->
<!--	# // value (#{}...) 부분은 dto와 매핑되는 값-->

<mapper namespace="mapper.campaign">

<!--	//상민 - campaignRegister(캠페인 등록)-->
	<insert id="registerCampaign" parameterType="campaign" >
		<![CDATA[
	   		INSERT INTO campaign (company_name, company_url, campaign_title, product_name, requirement,
	                     CHANNEL, image, category_id)
	    	VALUES (#{companyName}, #{companyUrl}, #{campaignTitle}, #{productName}, #{requirement},
	           			#{channel}, #{image}, #{categoryId})
	    ]]>
	</insert>

	<select id="selectCampaign" parameterType="Integer" resultType="campaign">											
		<![CDATA[
		 	select * from campaign where campaign_num = #{campaignNum}
		 	
		]]>
	</select>
	
	<select id="selectAllCampaign" parameterType="Map" resultType="campaign">
		select * from campaign 
			<where>
				<if test="channel != null and channel.size()>0">
					<foreach collection="channel" item="item" separator="or" open="(" close=")">
					 	channel like CONCAT('%', #{item},'%')
					 </foreach>
				</if>
				<if test="categoryId != 0">
					 and category_id=#{categoryId}
				</if>
			</where> 
		order by update_start_date desc limit #{row}, 8
	</select>
	
	<select id="selectCampaignCount" parameterType="Map" resultType="integer">
		select Count(*) from Campaign
		<where>
			<if test="channel != null and channel.size()>0">
				<foreach collection="channel" item="item" separator="or" open="(" close=")">
					channel like CONCAT('%', #{item},'%')
				</foreach>
			</if>
			<if test="categoryId != 0">
				and category_id=#{categoryId}
			</if>
		</where>
	
	</select>
	
	<select id="selectCampaignListForMain" resultType="campaign">
		<![CDATA[
			select * from campaign order by update_start_date desc limit 0, 8
		]]>
	</select>
	
	<select id="selectCampaignByAdNum" parameterType="integer" resultType="campaign">
		select * from campaign where advertiser_num = #{advertiserNum} order by update_start_date desc 
	</select>
</mapper>	

